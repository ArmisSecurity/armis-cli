image: alpine:3.20

pipelines:
  default:
    - step:
        name: Security Scan
        script:
          - apk add --no-cache curl bash docker
          - curl -sSL https://raw.githubusercontent.com/silk-security/Moose-CLI/main/scripts/install.sh | bash
          - armis-cli scan repo . --format json --fail-on HIGH,CRITICAL
        services:
          - docker
  
  branches:
    main:
      - step:
          name: Security Scan
          script:
            - apk add --no-cache curl bash docker
            - curl -sSL https://raw.githubusercontent.com/silk-security/Moose-CLI/main/scripts/install.sh | bash
            - armis-cli scan repo . --format json --fail-on CRITICAL
          services:
            - docker

definitions:
  services:
    docker:
      memory: 2048
